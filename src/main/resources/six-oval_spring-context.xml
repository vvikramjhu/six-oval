<?xml version="1.0" encoding="UTF-8"?>

<!-- /////////////////////////////////////////////////////////// -->
<!-- // Project SIX: OVAL                                     // -->
<!-- //                                                       // -->
<!-- // Spring Application Context                            // -->
<!-- /////////////////////////////////////////////////////////// -->

<!--
@author     Akihito Nakamura, AIST
@version    $Id$
-->

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:mvc="http://www.springframework.org/schema/mvc" 
    xsi:schemaLocation="
      http://www.springframework.org/schema/beans 
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/context 
      http://www.springframework.org/schema/context/spring-context.xsd
      http://www.springframework.org/schema/mvc
      http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd">


    <!-- external configurations -->
    <context:property-placeholder location="classpath:six-oval.properties"/>



    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
    <!-- %  OVAL Datastore                                     % -->
    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

    <bean id="mongo" 
        class="com.mongodb.Mongo">
        <constructor-arg type="java.lang.String" value="localhost"/>
        <constructor-arg type="int" value="27017"/>
    </bean> 


    <bean id="morphia" 
        class="jp.go.aist.six.oval.core.datastore.mongodb.MorphiaFactory" 
        factory-method="create"> 
        <constructor-arg>
            <set>
                <!-- value>#{ T(jp.go.aist.six.oval.model.v5.definitions.DefinitionType) }</value -->
            </set>
        </constructor-arg>
        <constructor-arg>
            <set>
                <value>#{ T(jp.go.aist.six.oval.core.datastore.mongodb.OvalConverter) }</value>
            </set>
        </constructor-arg>
    </bean>


    <bean id="datastore" 
        factory-bean="morphia" 
        factory-method="createDatastore"> 
        <constructor-arg ref="mongo"/> 
        <constructor-arg value="six"/> <!-- String: database name -->
    </bean>


    <bean id="ovalDefinitionsDAO" 
        class="jp.go.aist.six.oval.core.datastore.mongodb.OvalDefinitionsDAO">
        <constructor-arg ref="datastore"/> 
    </bean> 

    <bean id="definitionDAO" 
        class="jp.go.aist.six.oval.core.datastore.mongodb.DefinitionDAO">
        <constructor-arg ref="datastore"/> 
    </bean> 

    <bean id="testDAO" 
        class="jp.go.aist.six.oval.core.datastore.mongodb.TestDAO">
        <constructor-arg ref="datastore"/> 
    </bean> 

    <bean id="systemObjectDAO" 
        class="jp.go.aist.six.oval.core.datastore.mongodb.SystemObjectDAO">
        <constructor-arg ref="datastore"/> 
    </bean> 

    <bean id="stateDAO" 
        class="jp.go.aist.six.oval.core.datastore.mongodb.StateDAO">
        <constructor-arg ref="datastore"/> 
    </bean> 

    <bean id="variableDAO" 
        class="jp.go.aist.six.oval.core.datastore.mongodb.VariableDAO">
        <constructor-arg ref="datastore"/> 
    </bean> 


    <bean id="ovalSystemCharacteristicsDAO" 
        class="jp.go.aist.six.oval.core.datastore.mongodb.OvalSystemCharacteristicsDAO">
        <constructor-arg ref="datastore"/> 
    </bean> 

    <bean id="ovalResultsDAO" 
        class="jp.go.aist.six.oval.core.datastore.mongodb.OvalResultsDAO">
        <constructor-arg ref="datastore"/> 
    </bean> 


    <bean id="datastoreService" 
        class="jp.go.aist.six.oval.core.datastore.mongodb.MongoDatastore"> 
        <property name="DAO">
            <set>
                <ref bean="ovalDefinitionsDAO"/>
                <ref bean="definitionDAO"/>
                <ref bean="testDAO"/>
                <ref bean="systemObjectDAO"/>
                <ref bean="stateDAO"/>
                <ref bean="variableDAO"/>
                <ref bean="ovalSystemCharacteristicsDAO"/>
                <ref bean="ovalResultsDAO"/>
            </set>
        </property>
    </bean>



    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
    <!-- %  OVAL XML                                           % -->
    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

    <bean id="ovalMarshaller" 
      class="org.springframework.oxm.castor.CastorMarshaller">
        <property name="mappingLocations">
            <list>
                 <value>classpath:castor-xml_oval-5-six.xml</value>
                 <value>classpath:castor-xml_oval-5-common.xml</value>
                 <value>classpath:castor-xml_oval-5-definitions.xml</value>
                 <value>classpath:castor-xml_oval-5-sc.xml</value>
                 <value>classpath:castor-xml_oval-5-results.xml</value>
                 <value>classpath:castor-xml_oval-5-independent.xml</value>
                 <value>classpath:castor-xml_oval-5-linux.xml</value>
                 <value>classpath:castor-xml_oval-5-unix.xml</value>
                 <value>classpath:castor-xml_oval-5-windows.xml</value>
            </list>
        </property>
        <property name="ignoreExtraAttributes"
                 value="false"/>
        <property name="ignoreExtraElements"
                 value="false"/>
        <property name="suppressXsiType"
                 value="true"/>
        <property name="encoding"
                 value="UTF-8"/>
<!-- NO such property!!!
        <property name="schemaLocation"
                value="http://oval.mitre.org/XMLSchema/oval-common-5 oval-common-schema.xsd http://oval.mitre.org/XMLSchema/oval-system-characteristics-5 oval-system-characteristics-schema.xsd http://oval.mitre.org/XMLSchema/oval-definitions-5 oval-definitions-schema.xsd http://oval.mitre.org/XMLSchema/oval-results-5 oval-results-schema.xsd http://oval.mitre.org/XMLSchema/oval-definitions-5#windows windows-definitions-schema.xsd http://oval.mitre.org/XMLSchema/oval-system-characteristics-5#windows windows-system-characteristics-schema.xsd"/>
-->
        <property name="namespaceMappings">
            <map>
                <entry key="xsi"
                    value="http://www.w3.org/2001/XMLSchema-instance"/>
                <entry key="oval"
                    value="http://oval.mitre.org/XMLSchema/oval-common-5"/>
<!-- *****
-->
<!--
                <entry key="oval-def"
                    value="http://oval.mitre.org/XMLSchema/oval-definitions-5"/>
                <entry key="oval-sc"
                    value="http://oval.mitre.org/XMLSchema/oval-system-characteristics-5"/>
                <entry key="oval-sc-windows"
                    value="http://oval.mitre.org/XMLSchema/oval-system-characteristics-5#windows"/>
-->
            </map>
        </property>                    
    </bean> 


    <bean id="ovalXml" class="jp.go.aist.six.oval.core.xml.OvalXml">
        <property name="marshaller"   ref="ovalMarshaller"/>
        <property name="unmarshaller" ref="ovalMarshaller"/>
    </bean>



    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
    <!-- %  REST                                               % -->
    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

    <bean id="marshallingConverter" 
        class="org.springframework.http.converter.xml.MarshallingHttpMessageConverter"> 
        <constructor-arg ref="ovalMarshaller" /> 
        <property name="supportedMediaTypes" value="application/xml"/> 
    </bean> 


    <bean id="stringConverter" 
        class="org.springframework.http.converter.StringHttpMessageConverter"> 
        <property name="supportedMediaTypes" value="text/plain"/> 
    </bean> 

</beans>
