<?xml version="1.0" encoding="UTF-8"?>

<!-- ////////////////////////////////////////////////////////////////// -->
<!-- // Project SIX: OVAL                                            // -->
<!-- //                                                              // -->
<!-- // Spring Application Context: Repository                       // -->
<!-- ////////////////////////////////////////////////////////////////// -->

<!--
@author     Akihito Nakamura, AIST
@version    $Id$
-->

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:mvc="http://www.springframework.org/schema/mvc" 
    xsi:schemaLocation="
      http://www.springframework.org/schema/beans 
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/context 
      http://www.springframework.org/schema/context/spring-context.xsd
      http://www.springframework.org/schema/mvc
      http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd"
      >

    <!-- external configurations -->
    <context:property-placeholder location="classpath:jp/go/aist/six/oval/core/six-oval_defaults.properties,classpath:six-oval.properties"
        ignore-resource-not-found="true"
        />



    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
    <!-- %  repository                                         % -->
    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

    <bean id="mongo" 
        class="com.mongodb.Mongo">
        <constructor-arg type="java.lang.String" value="${six.oval.repository.database.host}"/>
        <constructor-arg type="int" value="${six.oval.repository.database.port}"/>
    </bean> 


    <bean id="morphia" 
        class="jp.go.aist.six.oval.core.repository.mongodb.MorphiaFactory" 
        factory-method="create"> 
        <constructor-arg>
            <set>
                <!-- value>#{ T(jp.go.aist.six.oval.model.definitions.DefinitionType) }</value -->
            </set>
        </constructor-arg>
        <constructor-arg>
            <set>
                <value>#{ T(jp.go.aist.six.oval.core.repository.mongodb.OvalConverter) }</value>
            </set>
        </constructor-arg>
    </bean>


    <bean id="morphia-datastore" 
        factory-bean="morphia" 
        factory-method="createDatastore"> 
        <constructor-arg ref="mongo"/> 
        <constructor-arg value="${six.oval.repository.database.name}"/>     <!-- String: database name -->
        <constructor-arg value="${six.oval.repository.database.username}"/> <!-- String: user name -->
        <constructor-arg value="${six.oval.repository.database.password}"/> <!-- String: user password -->
    </bean>


    <bean id="ovalDefinitionsDAO" 
        class="jp.go.aist.six.oval.core.repository.mongodb.OvalDefinitionsDAO">
        <constructor-arg ref="morphia-datastore"/> 
    </bean> 

    <bean id="definitionDAO" 
        class="jp.go.aist.six.oval.core.repository.mongodb.DefinitionDAO">
        <constructor-arg ref="morphia-datastore"/> 
    </bean> 

    <bean id="testDAO" 
        class="jp.go.aist.six.oval.core.repository.mongodb.TestDAO">
        <constructor-arg ref="morphia-datastore"/> 
    </bean> 

    <bean id="systemObjectDAO" 
        class="jp.go.aist.six.oval.core.repository.mongodb.SystemObjectDAO">
        <constructor-arg ref="morphia-datastore"/> 
    </bean> 

    <bean id="stateDAO" 
        class="jp.go.aist.six.oval.core.repository.mongodb.StateDAO">
        <constructor-arg ref="morphia-datastore"/> 
    </bean> 

    <bean id="variableDAO" 
        class="jp.go.aist.six.oval.core.repository.mongodb.VariableDAO">
        <constructor-arg ref="morphia-datastore"/> 
    </bean> 


    <bean id="ovalSystemCharacteristicsDAO" 
        class="jp.go.aist.six.oval.core.repository.mongodb.OvalSystemCharacteristicsDAO">
        <constructor-arg ref="morphia-datastore"/> 
    </bean> 

    <bean id="ovalResultsDAO" 
        class="jp.go.aist.six.oval.core.repository.mongodb.OvalResultsDAO">
        <constructor-arg ref="morphia-datastore"/> 
    </bean> 

    <bean id="definitionsElementAssocDAO" 
        class="jp.go.aist.six.oval.core.repository.mongodb.DefinitionsElementAssocDAO">
        <constructor-arg ref="morphia-datastore"/> 
    </bean> 



    <!-- ******************************************************* -->

    <bean id="oval-database" 
        class="jp.go.aist.six.oval.core.repository.mongodb.MongoOvalDatabase"> 
        <property name="DAO">
            <set>
                <ref bean="ovalDefinitionsDAO"/>
                <ref bean="definitionDAO"/>
                <ref bean="testDAO"/>
                <ref bean="systemObjectDAO"/>
                <ref bean="stateDAO"/>
                <ref bean="variableDAO"/>
                <ref bean="ovalSystemCharacteristicsDAO"/>
                <ref bean="ovalResultsDAO"/>

                <ref bean="definitionsElementAssocDAO"/>
            </set>
        </property>
    </bean>


    <bean id="mongo-oval-definition-repository" 
        class="jp.go.aist.six.oval.core.repository.mongodb.MongoOvalDefinitionRepository">
        <property name="database" ref="oval-database"/>
    </bean>


    <bean id="mongo-oval-repository" 
        class="jp.go.aist.six.oval.core.repository.mongodb.MongoOvalRepository">
        <property name="database" ref="oval-database"/>
    </bean>


    <bean id="oval-definitions-generator" 
        class="jp.go.aist.six.oval.core.repository.mongodb.OvalDefinitionsGenerator">
<!--
        <property name="datastore" ref="oval-database"/>
-->
    </bean>


</beans>
