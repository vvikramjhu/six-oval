<?xml version="1.0" encoding="UTF-8"?>

<!-- /////////////////////////////////////////////////////////// -->
<!-- // Project SIX: OVAL                                     // -->
<!-- //                                                       // -->
<!-- // Spring Application Context                            // -->
<!-- /////////////////////////////////////////////////////////// -->

<!--
@author     Akihito Nakamura, AIST
@version    $Id$
-->

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context" 
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">


    <!-- external configurations -->
    <context:property-placeholder location="classpath:six-oval.properties"/>



    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
    <!-- %  OVAL Data Store                                    % -->
    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

    <bean id="jdoManager" 
        class="org.castor.spring.orm.LocalCastorFactoryBean"
        >
        <property name="databaseName" value="oval"/>
        <property name="configLocation" value="classpath:six-oval_castor-jdo-conf.xml"/>
    </bean>

    <bean id="txManager" 
        class="org.castor.spring.orm.CastorTransactionManager"
        >
        <property name="JDOManager" ref="jdoManager"/>
    </bean>


    <!-- // DaoRegistry // -->
    <bean id="daoRegistry" 
        class="jp.go.aist.six.util.castor.FactoryDaoRegistry">
        <property name="JDOManager" ref="jdoManager"/>
        <property name="daoTypeMapping">
            <map>
                <entry key="jp.go.aist.six.oval.model.definitions.OvalDefinitions"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsDao"/> 
                    
                <entry key="jp.go.aist.six.oval.model.definitions.Definition"
                    value="jp.go.aist.six.oval.core.store.DefinitionDao"/>
                <entry key="jp.go.aist.six.oval.model.definitions.Test"
                    value="jp.go.aist.six.oval.core.store.TestDao"/>
                <entry key="jp.go.aist.six.oval.model.definitions.SystemObject"
                    value="jp.go.aist.six.oval.core.store.SystemObjectDao"/>
                <entry key="jp.go.aist.six.oval.model.definitions.State"
                    value="jp.go.aist.six.oval.core.store.StateDao"/>
                <entry key="jp.go.aist.six.oval.model.definitions.Variable"
                    value="jp.go.aist.six.oval.core.store.VariableDao"/>

                <entry key="jp.go.aist.six.oval.core.store.OvalDefinitionsDefinitionAssociationEntry"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsDefinitionAssociationEntryDao"/>
                <entry key="jp.go.aist.six.oval.core.store.OvalDefinitionsTestAssociationEntry"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsTestAssociationEntryDao"/>
                <entry key="jp.go.aist.six.oval.core.store.OvalDefinitionsSystemObjectAssociationEntry"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsSystemObjectAssociationEntryDao"/>
                <entry key="jp.go.aist.six.oval.core.store.OvalDefinitionsStateAssociationEntry"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsStateAssociationEntryDao"/>
                <entry key="jp.go.aist.six.oval.core.store.OvalDefinitionsVariableAssociationEntry"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsVariableAssociationEntryDao"/>
<!--
-->

<!-- NameEntity -->
                <entry key="jp.go.aist.six.oval.model.definitions.Platform"
                    value="jp.go.aist.six.oval.core.store.PlatformDao"/>
                <entry key="jp.go.aist.six.oval.model.definitions.Product"
                    value="jp.go.aist.six.oval.core.store.ProductDao"/>
                <entry key="jp.go.aist.six.oval.model.definitions.Cve"
                    value="jp.go.aist.six.oval.core.store.CveDao"/>
                <entry key="jp.go.aist.six.oval.model.definitions.Cpe"
                    value="jp.go.aist.six.oval.core.store.CpeDao"/>


<!-- // System Characteristics // -->

                <entry key="jp.go.aist.six.oval.model.sc.OvalSystemCharacteristics"
                    value="jp.go.aist.six.oval.core.store.OvalSystemCharacteristicsDao"/>


<!-- // Results // -->
            
                <entry key="jp.go.aist.six.oval.model.results.OvalResults"
                    value="jp.go.aist.six.oval.core.store.OvalResultsDao"/>

                <entry key="jp.go.aist.six.oval.core.store.OvalResultsOvalDefinitionsAssociationEntry"
                    value="jp.go.aist.six.oval.core.store.OvalResultsOvalDefinitionsAssociationEntryDao"/>

                <entry key="jp.go.aist.six.oval.core.store.SystemResultOvalSystemCharacteristicsAssociationEntry"
                    value="jp.go.aist.six.oval.core.store.SystemResultOvalSystemCharacteristicsAssociationEntryDao"/>


            <!-- // deprecated // -->

<!-- using pure CastoDao
                <entry key="jp.go.aist.six.oval.model.definitions.Reference"
                    value="jp.go.aist.six.oval.core.store.ReferenceDao"/>

                <entry key="jp.go.aist.six.oval.model.sc.Item"
                    value="jp.go.aist.six.oval.core.store.ItemDao"/>
-->                    

<!-- related or dependent relationship using Castor JDO Mapping  ==> ext
                <entry key="jp.go.aist.six.oval.core.model.definitions.OvalDefinitionsDefinitionAssociation"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsDefinitionAssociationDao"/>
                <entry key="jp.go.aist.six.oval.core.model.definitions.OvalDefinitionsTestAssociation"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsTestAssociationDao"/>
                <entry key="jp.go.aist.six.oval.core.model.definitions.OvalDefinitionsObjectAssociation"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsObjectAssociationDao"/>
                <entry key="jp.go.aist.six.oval.core.model.definitions.OvalDefinitionsStateAssociation"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsStateAssociationDao"/>
                <entry key="jp.go.aist.six.oval.core.model.definitions.OvalDefinitionsVariableAssociation"
                    value="jp.go.aist.six.oval.core.store.OvalDefinitionsVariableAssociationDao"/>

                <entry key="jp.go.aist.six.oval.model.sc.CollectedSystemObject"
                    value="jp.go.aist.six.oval.core.store.CollectedSystemObjectDao"/>
                <entry key="jp.go.aist.six.oval.core.model.results.OvalResultsOvalDefinitionsAssociation"
                    value="jp.go.aist.six.oval.core.store.OvalResultsOvalDefinitionsAssociationDao"/>

                <entry key="jp.go.aist.six.oval.core.model.results.OvalResultsSystemAssociation"
                    value="jp.go.aist.six.oval.core.store.OvalResultsSystemAssociationDao"/>
                <entry key="jp.go.aist.six.oval.model.results.SystemResult"
                    value="jp.go.aist.six.oval.core.store.SystemResultDao"/>
                <entry key="jp.go.aist.six.oval.model.results.DefinitionResult"
                    value="jp.go.aist.six.oval.core.store.DefinitionResultDao"/>
-->
            </map>
        </property>
    </bean>


    <bean id="dataStore" 
        class="jp.go.aist.six.util.castor.CastorDataStore">
        <property name="transactionManager" ref="txManager"/>
        <property name="daoRegistry" ref="daoRegistry"/>
    </bean>

    <bean id="ovalStore" 
        class="jp.go.aist.six.oval.core.store.OvalDataStore">
        <property name="dataStore" ref="dataStore"/>
    </bean>
<!--
    <bean id="ovalStore" 
        class="jp.go.aist.six.oval.core.store.OvalStore">
        <property name="dataStore" ref="dataStore"/>
    </bean>

    <bean id="ovalStore" 
        class="jp.go.aist.six.oval.core.store.OvalStore">
        <property name="transactionManager" ref="txManager"/>
        <property name="daoRegistry" ref="daoRegistry"/>
    </bean>
-->



    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
    <!-- %  OVAL XML                                           % -->
    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

    <bean id="ovalMarshaller" 
      class="org.springframework.oxm.castor.CastorMarshaller">
<!--
        <property name="mappingLocations">
            <list>
                 <value>classpath:six-oval_castor-xml-mapping.xml</value>
                 <value>classpath:six-util-search_castor-xml-mapping.xml</value>
            </list>
        </property>
-->
        <property name="mappingLocations"
                 value="classpath:six-oval_castor-xml-mapping.xml"/>
        <property name="ignoreExtraAttributes"
                 value="false"/>
        <property name="ignoreExtraElements"
                 value="false"/>
        <property name="suppressXsiType"
                 value="true"/>
        <property name="encoding"
                 value="UTF-8"/>
<!-- NO such property!!!
        <property name="schemaLocation"
                value="http://oval.mitre.org/XMLSchema/oval-common-5 oval-common-schema.xsd http://oval.mitre.org/XMLSchema/oval-system-characteristics-5 oval-system-characteristics-schema.xsd http://oval.mitre.org/XMLSchema/oval-definitions-5 oval-definitions-schema.xsd http://oval.mitre.org/XMLSchema/oval-results-5 oval-results-schema.xsd http://oval.mitre.org/XMLSchema/oval-definitions-5#windows windows-definitions-schema.xsd http://oval.mitre.org/XMLSchema/oval-system-characteristics-5#windows windows-system-characteristics-schema.xsd"/>
-->
        <property name="namespaceMappings">
            <map>
                <entry key="xsi"
                    value="http://www.w3.org/2001/XMLSchema-instance"/>
                <entry key="oval"
                    value="http://oval.mitre.org/XMLSchema/oval-common-5"/>
<!--
                <entry key="oval-def"
                    value="http://oval.mitre.org/XMLSchema/oval-definitions-5"/>
                <entry key="oval-sc"
                    value="http://oval.mitre.org/XMLSchema/oval-system-characteristics-5"/>
                <entry key="oval-sc-windows"
                    value="http://oval.mitre.org/XMLSchema/oval-system-characteristics-5#windows"/>
-->
            </map>
        </property>                    
    </bean> 


    <bean id="ovalXml" class="jp.go.aist.six.oval.core.xml.OvalXml">
        <property name="marshaller"   ref="ovalMarshaller"/>
        <property name="unmarshaller" ref="ovalMarshaller"/>
    </bean>



    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
    <!-- %  REST                                               % -->
    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

    <bean id="marshallingConverter" 
        class="org.springframework.http.converter.xml.MarshallingHttpMessageConverter"> 
        <constructor-arg ref="ovalMarshaller" /> 
        <property name="supportedMediaTypes" value="application/xml"/> 
    </bean> 

    <bean id="stringConverter" 
        class="org.springframework.http.converter.StringHttpMessageConverter"> 
        <property name="supportedMediaTypes" value="text/plain"/> 
    </bean> 

<!--
    <bean id="resourceConverter" 
        class="org.springframework.http.converter.ResourceHttpMessageConverter"> 
    </bean> 
-->

    <bean id="restTemplate" 
        class="org.springframework.web.client.RestTemplate">
        <property name="messageConverters">
            <list>
                <ref bean="stringConverter" />
                <ref bean="marshallingConverter" />
<!--
                <ref bean="atomConverter"  />
                <ref bean="jsonConverter" />
-->
            </list>
        </property>
    </bean>


    <bean id="ovalRepositoryRestClient" 
        class="jp.go.aist.six.oval.core.rest.OvalRepositoryClient"> 
        <property name="restTemplate" ref="restTemplate"/> 
        <property name="baseUri" value="${six.oval.rest.base-uri}"/> 
    </bean> 


</beans>
