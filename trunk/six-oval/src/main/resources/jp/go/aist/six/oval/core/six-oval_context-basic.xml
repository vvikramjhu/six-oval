<?xml version="1.0" encoding="UTF-8"?>

<!-- /////////////////////////////////////////////////////////// -->
<!-- // Project SIX: OVAL                                     // -->
<!-- //                                                       // -->
<!-- // Spring Application Context                            // -->
<!-- /////////////////////////////////////////////////////////// -->

<!--
@author     Akihito Nakamura, AIST
@version    $Id$
-->

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:util="http://www.springframework.org/schema/util"
    xmlns:mvc="http://www.springframework.org/schema/mvc" 
    xsi:schemaLocation="
      http://www.springframework.org/schema/beans 
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/context 
      http://www.springframework.org/schema/context/spring-context.xsd
      http://www.springframework.org/schema/util 
      http://www.springframework.org/schema/util/spring-util-3.0.xsd
      http://www.springframework.org/schema/mvc
      http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd">


    <!-- external configurations -->
    <context:property-placeholder 
        location="classpath:jp/go/aist/six/oval/core/six-oval_defaults.properties,classpath:six-oval.properties"
        ignore-resource-not-found="true"
        system-properties-mode="OVERRIDE"
        />
        <!-- NOTE: 
        location: Properties defined in later files will override properties defined earlier files, 
            in case of overlapping keys.
        system-properties-mode: "override" will check for a system property first, 
            before trying the specified properties. 
        -->


    <!-- ************************************************************** -->
    <!-- *  Properties                                                * -->
    <!-- ************************************************************** -->

    <util:properties id="six-oval-default-properties" 
        location="classpath:jp/go/aist/six/oval/core/six-oval_defaults.properties"/>

    <util:properties id="six-oval-properties" 
        location="classpath:six-oval.properties"/>

<!-- DO NOT USE THIS!
    <context:property-override location="classpath:six-oval.properties"
        ignore-resource-not-found="true"
        />
-->


    <!-- ************************************************************** -->
    <!-- *  XML                                                       * -->
    <!-- ************************************************************** -->

    <bean id="oval-marshaller" 
       class="org.springframework.oxm.castor.CastorMarshaller">
        <property name="mappingLocations">
            <list>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-six.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-common.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-definitions.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-sc.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-results.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-variables.xml</value>

                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-independent.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-linux.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-macos.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-solaris.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-unix.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-5-windows.xml</value>
                 <value>classpath:jp/go/aist/six/oval/core/xml/castor-xml_oval-six-core.xml</value>
            </list>
        </property>
        <property name="ignoreExtraAttributes" value="false"/>
        <property name="ignoreExtraElements"   value="false"/>
        <property name="suppressXsiType"       value="true"/>
        <property name="encoding"              value="UTF-8"/>

<!-- TODO: Spring 3.1 supports this???
Spring 3.0 does NOT support such a property of CastorMarshaller!!!
        <property name="schemaLocation"
                value="http://oval.mitre.org/XMLSchema/oval-common-5 oval-common-schema.xsd http://oval.mitre.org/XMLSchema/oval-system-characteristics-5 oval-system-characteristics-schema.xsd http://oval.mitre.org/XMLSchema/oval-definitions-5 oval-definitions-schema.xsd http://oval.mitre.org/XMLSchema/oval-results-5 oval-results-schema.xsd http://oval.mitre.org/XMLSchema/oval-definitions-5#windows windows-definitions-schema.xsd http://oval.mitre.org/XMLSchema/oval-system-characteristics-5#windows windows-system-characteristics-schema.xsd"/>
-->

        <property name="namespaceMappings">
            <map>
                <entry key="xsi"        value="http://www.w3.org/2001/XMLSchema-instance"/>
                <entry key="oval"       value="http://oval.mitre.org/XMLSchema/oval-common-5"/>
                <entry key="oval-def"   value="http://oval.mitre.org/XMLSchema/oval-definitions-5"/>
                <entry key="oval-sc"    value="http://oval.mitre.org/XMLSchema/oval-system-characteristics-5"/>
                <entry key="opensearch" value="http://a9.com/-/spec/opensearch/1.1/"/>

<!--
                <entry key="six" value="http://aist.go.jp/six/oval"/>
                <entry key="oval-sc-windows"
                    value="http://oval.mitre.org/XMLSchema/oval-system-characteristics-5#windows"/>
-->
            </map>
        </property>
    </bean> 


    <bean id="oval-xml-transformer" 
       class="jp.go.aist.six.util.xml.XmlTransformer"> 
        <constructor-arg type="java.net.URL" 
                        value="classpath:jp/go/aist/six/oval/core/xml/oval5-transform.xsl"/>

<!-- The following constructor-based DI does NOT work, 
     because there is a constructor with a String argument: XmlTransformer( String stylesheet ).
        <constructor-arg>
            <value>classpath:oval5-transform.xsl</value>
        </constructor-arg>
-->
    </bean>


    <bean id="oval-xml-mapper" 
       class="jp.go.aist.six.oval.core.xml.OvalTransformXmlMapper">
        <property name="marshaller"   ref="oval-marshaller"/>
        <property name="unmarshaller" ref="oval-marshaller"/>
        <property name="transformer"  ref="oval-xml-transformer"/>
    </bean>

<!--
    <bean id="ovalXmlMapper" class="jp.go.aist.six.oval.core.xml.OvalXmlMapper">
        <property name="marshaller"   ref="ovalMarshaller"/>
        <property name="unmarshaller" ref="ovalMarshaller"/>
    </bean>
-->




    <!-- ************************************************************** -->
    <!-- *  Web                                                       * -->
    <!-- ************************************************************** -->

    <bean id="marshalling-converter" 
        class="org.springframework.http.converter.xml.MarshallingHttpMessageConverter"> 
        <constructor-arg ref="oval-marshaller" /> 
        <property name="supportedMediaTypes" value="application/xml"/> 
    </bean> 

<!--
    <bean id="atom-converter" 
        class="org.springframework.http.converter.feed.AtomFeedHttpMessageConverter"> 
        <property name="supportedMediaTypes" value="application/atom+xml"/> 
    </bean> 
-->

    <!-- the default set of converters registered automatically, 
    e.g. 
    <bean id="stringConverter" 
        class="org.springframework.http.converter.StringHttpMessageConverter"> 
        <property name="supportedMediaTypes" value="text/plain"/> 
    </bean> 
    --> 


<!--
    <bean id="rest-template" scope="prototype" 
        class="org.springframework.web.client.RestTemplate">
        <property name="messageConverters"> 
            <list> 
                <ref bean="marshalling-converter" /> 
            </list> 
        </property>
    </bean>
-->
                <!-- ref bean="atom-converter" / --> 



    <!-- ************************************************************** -->
    <!-- *  Repository                                                * -->
    <!-- ************************************************************** -->

    <bean id="http-oval-repository-client" 
        class="jp.go.aist.six.oval.core.repository.web.HttpOvalRepositoryClient"> 
        <property name="repositoryBaseUrl" value="${six.oval.repository.web.base-url}"/> 
        <property name="messageConverters"> 
            <list> 
                <ref bean="marshalling-converter" /> 
                <!-- ref bean="atom-converter" / --> 
            </list> 
        </property>
    </bean> 

</beans>
